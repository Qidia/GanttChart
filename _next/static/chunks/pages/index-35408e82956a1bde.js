(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{45728:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(60365)}])},60365:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return pages}});var n=a(85893),s=a(9008),l=a.n(s),r=a(67294),o=a(85852),i=a.n(o),c=a(94806),d=a.n(c),u=a(73935),h=a(90309),m=a.n(h),Button_Button=e=>{let{prefix:t,type:a,children:s,className:l,id:r,onClick:o}=e;return(0,n.jsxs)("button",{className:l,type:a,id:r,onClick:o,title:"string"==typeof s?s:null,children:[t&&(0,n.jsx)("div",{children:t}),s]})};let Modal=e=>{let{isOpen:t,titleModal:a,onClose:s,children:l,type:o}=e,i=(0,r.useRef)(null);return(0,r.useEffect)(()=>{let handleOutsideClick=e=>{i.current&&!i.current.contains(e.target)&&s()},handleKeyPress=e=>{"Escape"===e.key&&s()};return t&&(document.addEventListener("mousedown",handleOutsideClick),document.addEventListener("keydown",handleKeyPress)),()=>{t&&(document.removeEventListener("mousedown",handleOutsideClick),document.removeEventListener("keydown",handleKeyPress))}},[t,s]),t&&(0,u.createPortal)((0,n.jsx)("div",{className:"DepartmentsModal"===o?m().departmentsModalContainer:m().modalContainer,children:(0,n.jsxs)("div",{ref:i,className:"DepartmentsModal"===o?m().departmentsModalContent:m().modalContent,children:[(0,n.jsxs)("header",{className:m().modalHeader,children:[(0,n.jsx)("h2",{className:m().modalHeaderTitle,children:a}),(0,n.jsx)(Button_Button,{onClick:()=>s(),className:m().closeButton,children:(0,n.jsx)("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",viewBox:"1 0 30 30",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{d:"M 7.21875 5.78125 L 5.78125 7.21875 L 14.5625 16 L 5.78125 24.78125 L 7.21875 26.21875 L 16 17.4375 L 24.78125 26.21875 L 26.21875 24.78125 L 17.4375 16 L 26.21875 7.21875 L 24.78125 5.78125 L 16 14.5625 Z"})})})]}),(0,n.jsx)("main",{className:"DepartmentsModal"===o?m().departmentsModalMain:m().modalMain,children:l})]})}),document.body)};var _=a(55846),p=a.n(_),Select_Select=e=>{let{options:t,disabled:a,label:s,onSelectChange:l,className:o,selectedOption:i}=e,[c,d]=(0,r.useState)(!1),[u,h]=(0,r.useState)(i),m=(0,r.useRef)(null),handleOptionClick=e=>{if(e.label===u){d(!1);return}h(e.label),d(!1),l&&l(e)},handleClickOutside=e=>{m.current&&!m.current.contains(e.target)&&d(!1)},handleKeyPress=e=>{switch(e.key){case"Escape":case"Enter":d(!1)}};return(0,r.useEffect)(()=>(document.addEventListener("click",handleClickOutside),document.addEventListener("keydown",handleKeyPress),()=>{document.removeEventListener("click",handleClickOutside),document.removeEventListener("keydown",handleKeyPress)}),[]),(0,r.useEffect)(()=>{h(i)},[i]),(0,n.jsxs)("div",{className:"".concat(p().select," ").concat(o),ref:m,children:[s&&(0,n.jsx)("div",{className:"m-r-10",children:s}),(0,n.jsx)("input",{type:"text",disabled:a,value:u,onClick:()=>{d(!c)},readOnly:!0,className:"".concat(p().input," ").concat(a?p().disabled:p().enabled)}),c&&(0,n.jsx)("div",{className:p().dropdown,children:t.map((e,t)=>(0,n.jsx)("div",{onClick:()=>handleOptionClick(e),className:"m-b-4 ".concat(p().option," ").concat(e.label===u?p().selectedOption:""),children:e.label},t))})]})},x=a(77767),k=a.n(x),g=a(30286),D=a(26884);a(35740),a(82806);var DateRangeProduction_DateRangeProduction=e=>{let{initialStartDate:t,initialEndDate:a,onDateRangeChange:s}=e,[l,o]=(0,r.useState)([{startDate:t,endDate:a,key:"selection"}]),[i,c]=(0,r.useState)(!1),d=(0,r.useRef)(null);(0,r.useEffect)(()=>{o([{startDate:t,endDate:a,key:"selection"}])},[t,a]),(0,r.useEffect)(()=>(document.addEventListener("click",hideOnClickOutside,!0),()=>document.removeEventListener("click",hideOnClickOutside,!0)),[]);let hideOnClickOutside=e=>{d.current&&!d.current.contains(e.target)&&c(!1)};return(0,n.jsxs)("div",{className:k().calendarWrap,children:[(0,n.jsx)("input",{className:k().dateInput,value:"".concat((0,D.ZP)(l[0].startDate,"dd/MM/yyyy")," до ").concat((0,D.ZP)(l[0].endDate,"dd/MM/yyyy")),readOnly:!0,onClick:()=>c(e=>!e)}),(0,n.jsx)("div",{className:k().calendar,ref:d,children:i&&(0,n.jsx)(g.C0,{className:k().dateRange,onChange:e=>{let resetTime=e=>{let t=new Date(e);return t.setHours(3,0,0,0),t},t=resetTime(e.selection.startDate),a=resetTime(e.selection.endDate);o([{startDate:t,endDate:a,key:"selection"}]),s({startDate:t,endDate:a})},editableDateInputs:!0,moveRangeOnFirstSelection:!1,ranges:l,months:1,direction:"horizontal"})})]})},C=a(87575),j=a.n(C),Checkbox_Checkbox=e=>{let{label:t,checked:a,onChange:s,className:l}=e,[o,i]=(0,r.useState)(a||!1);return(0,r.useEffect)(()=>{i(a)},[a]),(0,n.jsxs)("label",{className:"".concat(j().checkbox," ").concat(l),children:[(0,n.jsx)("input",{type:"checkbox",checked:o,onChange:()=>{let e=!o;i(e),s&&s(e)},className:"".concat(j().input," m-r-10")}),(0,n.jsx)("span",{className:j().customCheckbox}),(0,n.jsx)("span",{className:j().label,children:t})]})},f=a(87509),GanttChartManagement_GanttChartManagement=e=>{let{className:t,isNamesVisible:a,setIsNamesVisible:s,isLineVisible:l,setIsLineVisible:o,setSelectedOption:i,onDateRangeChange:c}=e,[u,h]=(0,r.useState)(!1),[m,_]=(0,r.useState)(a),[p,x]=(0,r.useState)("По отделам"),[k,g]=(0,r.useState)({startDate:new Date,endDate:(0,f.Z)(new Date,7)});return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:t,children:[(0,n.jsx)(Button_Button,{onClick:()=>{h(!0)},className:d().btnOpenModal,children:(0,n.jsx)("svg",{viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",role:"presentation",focusable:"false",children:(0,n.jsxs)("g",{fill:"none",fillRule:"nonzero",children:[(0,n.jsx)("path",{d:"m2 16h28"}),(0,n.jsx)("path",{d:"m2 24h28"}),(0,n.jsx)("path",{d:"m2 8h28"})]})})}),(0,n.jsx)(Modal,{isOpen:u,titleModal:"Панель управления",onClose:()=>{h(!1)},className:d().titleModal,children:(0,n.jsxs)("div",{className:d().modalContent,children:[(0,n.jsxs)("div",{className:"".concat(d().dateRangeComp," m-b-10"),children:[(0,n.jsx)("p",{className:"m-r-10",children:"Дата:"}),(0,n.jsx)(DateRangeProduction_DateRangeProduction,{initialStartDate:k.startDate,initialEndDate:k.endDate,onDateRangeChange:e=>{g(e),c(e)}})]}),(0,n.jsx)(Select_Select,{options:[{label:"По отделам"},{label:"По статусу"}],label:"Цвет:",disabled:!1,selectedOption:p,onSelectChange:e=>{x(e.label),i(e.label)},className:"m-b-10"}),(0,n.jsx)(Checkbox_Checkbox,{label:"Наименования",checked:m,onChange:e=>{_(e),s(e)},className:"".concat(d().checkbox," m-b-10")}),(0,n.jsx)(Checkbox_Checkbox,{label:"Горизонтальная линия",checked:l,onChange:e=>{o(e)},className:"".concat(d().checkbox," m-b-10")})]})})]})})},v=a(11293),b=a.n(v),w=a(54875),N=a.n(w),HorizontalLine_HorizontalLine=()=>{let[e,t]=(0,r.useState)(!1),[a,s]=(0,r.useState)({x:0,y:0});return(0,n.jsx)("div",{className:N().container,onMouseMove:e=>{let{clientX:a,clientY:n}=e,l=e.currentTarget.getBoundingClientRect();a>=l.left&&a<=l.right&&n>=l.top&&n<=l.bottom?(s({x:a-l.left,y:n-l.top}),t(!0)):t(!1)},children:e&&(0,n.jsx)("div",{className:N().line,style:{top:a.y}})})},M=a(42745),S=a.n(M),L=a(23018),y=a.n(L),TaskTooltip_TaskTooltip=e=>{let{task:t,department:a,position:s,horizontalLineHeight:l,color:o}=e,i=(0,r.useRef)(null),[c,d]=(0,r.useState)({visibility:"hidden"});return((0,r.useEffect)(()=>{if(i.current){let e=i.current.getBoundingClientRect(),t={top:s.top+10,left:s.left+10},a=t.top>l?l:0;t.left+e.width>window.innerWidth-35&&(t.left=s.left-e.width-10),t.top+e.height+a>window.innerHeight-35&&(t.top=s.top-e.height-a-10),t.left<35&&(t.left=s.left+10),t.top<35&&(t.top=s.top+10),d({...t,visibility:"visible"})}},[s,l]),t&&a)?(0,n.jsxs)("div",{ref:i,className:y().tooltip,style:{top:c.top,left:c.left,visibility:c.visibility},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Отдел:"})," ",a.name]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"ID задачи:"})," ",t.id]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Название:"})," ",t.title]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Исполнитель:"})," ",t.assignee]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Начало:"})," ",new Date(t.startDate).toLocaleDateString()]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Конец:"})," ",new Date(t.endDate).toLocaleDateString()]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Статус:"})," ",t.status]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Цвет:"})," ",(0,n.jsx)("span",{style:{backgroundColor:o},className:y().colorBox})]})]}):null},E=a(68818),T=a.n(E),DepartmentsModal_DepartmentsModal=e=>{let{isOpen:t,onClose:a,department:s}=e;return(0,n.jsx)("div",{className:T().overlay,children:(0,n.jsx)(Modal,{isOpen:t,titleModal:s.name,onClose:a,type:"DepartmentsModal",children:(0,n.jsx)("div",{className:T().modalContent,children:(0,n.jsx)(Grid_Grid,{data:[s],isLineVisible:!1,showArrows:!0,showSubtasks:!0})})})})},TaskRectangles_TaskRectangles=e=>{let{data:t,minDate:a,maxDate:s,maxVerticalLines:l,showSubtasks:o,departmentColors:i,selectedOption:c,step:d}=e,[u,h]=(0,r.useState)({task:null,department:null,position:null,color:null}),[m,_]=(0,r.useState)(null),[p,x]=(0,r.useState)(!1),handleMouseEnter=(e,t,a,n)=>{let s=e.clientX,l=e.clientY;h({task:t,department:a,color:n,position:{top:l,left:s}})},handleMouseLeave=()=>{h({task:null,department:null,position:null,color:null})},handleDepartmentClick=e=>{_(e),x(!0)},findPosition=e=>{console.log(k);let t=k.findIndex(t=>e<=t);if(0===t)return 0;if(-1===t)return 100;let a=k[t-1],n=k[t],s=(e-a)/(n-a)*100;return(t-1)/(l-1)*100+s/(l-1)},getTaskColor=(e,t,a)=>"По отделам"===c?i[t.id||"department-".concat(a)]:getStatusColor(e.status),getStatusColor=e=>{switch(e){case"не назначена":return"#90908c";case"назначена":return"#00CED1";case"в работе":return"#4682B4";case"закрыта":return"#00FF7F";case"условно закрыта":return"#EE82EE";case"частично закрыта":return"#9400D3";default:return"#e94639"}};if(!a||!s)return null;let k=Array.from({length:l},(e,t)=>{let a=new Date(s);return a.setDate(s.getDate()-Math.round(d*t)),a}).reverse(),renderTask=function(e,l,r,i,c){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=new Date(e.startDate),h=new Date(e.endDate);if(u<a||h>s)return null;let m=findPosition(u),_=findPosition(h),p=(2*l+.3)*100/(2*t.length)+r*i/(c.tasks.length||1),x=getTaskColor(e,c,l),k=e.tasks&&e.tasks.length>0,g={top:"".concat(o?0:p,"%"),height:"".concat(o?100:i/(c.tasks.length||1),"%"),left:"".concat(m,"%"),width:"".concat(_-m,"%"),backgroundColor:k&&o?"transparent":x,position:"absolute",outline:"1px solid transparent",...o&&{outline:"2px solid black",outlineOffset:"-1px"}};return(0,n.jsxs)("div",{className:"".concat(o?S().showSubtasks_Subtasks:""),children:[(0,n.jsx)("div",{className:" ".concat(o?"":S().taskRectangle),style:g,onMouseEnter:t=>handleMouseEnter(t,e,c,x),onMouseLeave:handleMouseLeave,onClick:()=>handleDepartmentClick(c)}),o&&e.tasks&&(0,n.jsx)("div",{className:S().showSubtasks_Task,children:e.tasks.map((e,t)=>renderTask(e,l,t,i,c,d+1))})]},"".concat(e.id,"-").concat(r))};return(0,n.jsxs)("div",{className:"".concat(S().containerHorizontalLine," ").concat(o?S().showSubtasks_Task:""),children:[t.map((e,a)=>{let n=100/(2*t.length);return e.tasks.map((t,s)=>renderTask(t,a,s,n,e))}),u.task&&(0,n.jsx)(TaskTooltip_TaskTooltip,{task:u.task,department:u.department,position:u.position,color:u.color}),!o&&m&&(0,n.jsx)(DepartmentsModal_DepartmentsModal,{isOpen:p,onClose:()=>{x(!1),_(null)},department:m})]})},Grid_Grid=e=>{let t,a,{data:s,isLineVisible:l,showSubtasks:r,departmentColors:o,selectedOption:i,dateRange:c}=e;if(c&&c.startDate&&c.endDate&&new Date(c.startDate)<new Date(c.endDate))t=new Date(c.startDate),a=new Date(c.endDate);else{let e=(()=>{if(!s||0===s.length)return{minDate:null,maxDate:null};let e=new Date(s[0].tasks[0].startDate),t=new Date(s[0].tasks[0].endDate);return s.forEach(a=>{a.tasks.forEach(a=>{let n=new Date(a.startDate),s=new Date(a.endDate);n<e&&(e=n),s>t&&(t=s),a.tasks&&a.tasks.length>0&&a.tasks.forEach(a=>{let n=new Date(a.startDate),s=new Date(a.endDate);n<e&&(e=n),s>t&&(t=s),a.tasks&&a.tasks.length>0&&a.tasks.forEach(a=>{let n=new Date(a.startDate),s=new Date(a.endDate);n<e&&(e=n),s>t&&(t=s)})})})}),{minDate:e,maxDate:t}})();t=e.minDate,a=e.maxDate}if(!t||!a)return null;let d=Math.ceil((a-t)/864e5),u=Math.min(d+1,30),h=d/(u-1);return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:b().grid,children:[(0,n.jsx)("div",{className:b().containerVerticalLine,children:(()=>{let e=[];for(let a=0;a<u;a++){let n=new Date(t);n.setDate(t.getDate()+Math.round(h*a)),e.push(n)}return e.map((e,t)=>(0,n.jsxs)("div",{className:b().verticalLines,children:[(0,n.jsx)("div",{className:b().verticalLine}),(0,n.jsx)("div",{className:b().date,children:e.toLocaleDateString()})]},t))})()}),(0,n.jsxs)("div",{className:b().containerHorizontalLine,children:[l&&(0,n.jsx)(HorizontalLine_HorizontalLine,{}),(0,n.jsx)(TaskRectangles_TaskRectangles,{data:s,minDate:t,maxDate:a,maxVerticalLines:u,showSubtasks:r,departmentColors:o,selectedOption:i,step:h})]})]})})},G=a(82023),O=a.n(G),GanttChart_GanttChart=e=>{let{data:t}=e,[a,s]=(0,r.useState)(!1),[l,o]=(0,r.useState)(!1),[c,d]=(0,r.useState)("По отделам"),[u,h]=(0,r.useState)(null),[m,_]=(0,r.useState)(!1),[p,x]=(0,r.useState)({}),[k,g]=(0,r.useState)({startDate:null,endDate:null});(0,r.useEffect)(()=>{if(t&&t.length>0){let e=O()({count:t.length,luminosity:"bright",hue:"random"}),a=t.reduce((t,a,n)=>(t[a.id||"department-".concat(n)]=e[n],t),{});x(a)}},[t]);let handleDepartmentClick=e=>{h(e),_(!0)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(GanttChartManagement_GanttChartManagement,{className:i().management,isNamesVisible:a,setIsNamesVisible:s,isLineVisible:l,setIsLineVisible:o,setSelectedOption:d,onDateRangeChange:e=>{g(e)}}),(0,n.jsxs)("div",{className:i().container,children:[a&&(0,n.jsxs)("div",{className:i().departmentsNames,children:[(0,n.jsx)("h3",{children:"Список подразделений"}),(0,n.jsx)("div",{className:i().departmentName,children:(0,n.jsx)("div",{className:"m-l-15 m-r-15",children:t.map((e,t)=>(0,n.jsx)(Button_Button,{className:i().departmentButton,onClick:()=>handleDepartmentClick(e),children:e.name},e.id||"department-".concat(t)))})})]}),(0,n.jsx)("div",{className:i()["containerСharts"],children:(0,n.jsx)("div",{className:" ".concat(i().charts," ").concat(a?"".concat(i().openDepartmentName):"".concat(i().closeDepartmentName)),children:(0,n.jsx)(Grid_Grid,{data:t,isLineVisible:l,showSubtasks:!1,departmentColors:p,selectedOption:c,dateRange:k})})})]}),u&&(0,n.jsx)(DepartmentsModal_DepartmentsModal,{isOpen:m,onClose:()=>{_(!1),h(null)},department:u})]})},DataProvider_DataProvider=e=>{let{children:t}=e,[a,s]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let fetchData=async()=>{try{let e=await fetch("/api/departments");if(!e.ok)throw Error("Failed to fetch data");let t=await e.json();s(t)}catch(e){console.error("Error fetching data:",e)}};fetchData()},[]),(0,n.jsx)(n.Fragment,{children:a&&r.Children.map(t,e=>r.cloneElement(e,{data:a}))})},pages=()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(l(),{children:[(0,n.jsx)("title",{children:"Gantt_Chart"}),(0,n.jsx)("meta",{httpEquiv:"X-UA-Compatible",content:"IE=edge"}),(0,n.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"})]}),(0,n.jsx)("main",{children:(0,n.jsx)(DataProvider_DataProvider,{children:(0,n.jsx)(GanttChart_GanttChart,{})})})]})},77767:function(e){e.exports={calendarWrap:"DateRangeProduction_calendarWrap__I86LQ",dateInput:"DateRangeProduction_dateInput__bwrc5",calendar:"DateRangeProduction_calendar__QKmQb",dateRange:"DateRangeProduction_dateRange__vElW_"}},68818:function(e){e.exports={modalContent:"DepartmentsModal_modalContent__eHjY5",overlay:"DepartmentsModal_overlay__zHfMX"}},94806:function(e){e.exports={btnOpenModal:"GanttChartManagement_btnOpenModal__WQGIF",modalContent:"GanttChartManagement_modalContent__LE1xl",checkbox:"GanttChartManagement_checkbox__jntsI"}},85852:function(e){e.exports={management:"GanttChart_management__sTK1U",container:"GanttChart_container__Ha0_y",departmentsNames:"GanttChart_departmentsNames__I7xPk",departmentName:"GanttChart_departmentName__f4yqw",departmentButton:"GanttChart_departmentButton__lMQMZ",containerСharts:"GanttChart_container_harts__BuM7a",charts:"GanttChart_charts__zrtqM",closeDepartmentName:"GanttChart_closeDepartmentName__3vSK8",openDepartmentName:"GanttChart_openDepartmentName__AzbPM"}},11293:function(e){e.exports={grid:"Grid_grid__vWN5w",containerVerticalLine:"Grid_containerVerticalLine__T8xS7",verticalLines:"Grid_verticalLines__miGlZ",verticalLine:"Grid_verticalLine__0_bRN",date:"Grid_date__N6CEd",containerHorizontalLine:"Grid_containerHorizontalLine__lf4dF"}},54875:function(e){e.exports={container:"HorizontalLine_container__bahRD",line:"HorizontalLine_line__ELzv6"}},42745:function(e){e.exports={taskRectangle:"TaskRectangles_taskRectangle__ZjplU",arrow:"TaskRectangles_arrow__aMIBX",arrowHead:"TaskRectangles_arrowHead__xh5iz",showSubtasks_Task:"TaskRectangles_showSubtasks_Task__F5GVJ",showSubtasks_Subtasks:"TaskRectangles_showSubtasks_Subtasks__om4sw"}},23018:function(e){e.exports={tooltip:"TaskTooltip_tooltip__dY_5S",colorBox:"TaskTooltip_colorBox__VmmyH"}},87575:function(e){e.exports={checkbox:"Checkbox_checkbox__3y1kM",input:"Checkbox_input__4qhLF",customCheckbox:"Checkbox_customCheckbox__7C_hW"}},90309:function(e){e.exports={modalContainer:"Modal_modalContainer__mCce2",modalContent:"Modal_modalContent__KldGk",modalHeader:"Modal_modalHeader___6xwd",modalHeaderTitle:"Modal_modalHeaderTitle__guh0J",closeButton:"Modal_closeButton__I5Fou",departmentsModalContainer:"Modal_departmentsModalContainer__TJO_Q",departmentsModalContent:"Modal_departmentsModalContent__kg0uD",departmentsModalMain:"Modal_departmentsModalMain__BoOoD"}},55846:function(e){e.exports={select:"Select_select___kDLS",input:"Select_input__F8X2u",disabled:"Select_disabled__JqGOh",enabled:"Select_enabled__VIcxY",dropdown:"Select_dropdown__0WWC0",option:"Select_option__O61wS",selectedOption:"Select_selectedOption__yTSXg"}}},function(e){e.O(0,[861,774,888,179],function(){return e(e.s=45728)}),_N_E=e.O()}]);